<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Reactions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: purple;
            color: white;
        }
        .reaction-card {
            background-color: black;
            color: white;
            padding: 20px;
            margin: 10px;
            border-radius: 5px;
            display: inline-block;
            width: 300px;
        }
        .add-reaction {
            margin-top: 20px;
        }
        input, select, textarea {
            margin: 5px;
            padding: 10px;
            width: 200px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Manage Chemical Reactions</h1>
    <a href="/">Manage Chemicals</a>
    <div id="reactions-container"></div>

    <div class="add-reaction">
        <h2>Add New Reaction</h2>
        <select id="reactantSelect" multiple></select>
        <select id="productSelect" multiple></select>
        <input type="text" id="reactionType" placeholder="Reaction Type">
        <textarea id="balancedEquation" placeholder="Balanced Equation"></textarea>
        <label>Deposition: 
            <input type="radio" name="deposition" value="true"> Yes
            <input type="radio" name="deposition" value="false" checked> No
        </label>
        <button id="addReactionButton">Add Reaction</button>
    </div>

    <script>
        let reactions = [];
        let chemicals = [];

        // Load solution colors for reactants/products
        fetch('/solutionColors')
            .then(response => response.json())
            .then(data => {
                chemicals = data;
                populateSelects();
            })
            .catch(error => console.error('Error loading solution colors:', error));

        // Load reactions
        fetch('/reactions')
            .then(response => response.json())
            .then(data => {
                reactions = data;
                displayReactions();
            })
            .catch(error => console.error('Error loading reactions:', error));

        function populateSelects() {
            const reactantSelect = document.getElementById('reactantSelect');
            const productSelect = document.getElementById('productSelect');

            chemicals.forEach(chemical => {
                const reactantOption = document.createElement('option');
                reactantOption.value = chemical.name;
                reactantOption.textContent = `${chemical.displayName} (${chemical.name})`;
                reactantSelect.appendChild(reactantOption);

                const productOption = document.createElement('option');
                productOption.value = chemical.name;
                productOption.textContent = `${chemical.displayName} (${chemical.name})`;
                productSelect.appendChild(productOption);
            });
        }

        function displayReactions() {
            const container = document.getElementById('reactions-container');
            container.innerHTML = '';

            reactions.forEach((reaction, index) => {
                const card = document.createElement('div');
                card.className = 'reaction-card';

                card.innerHTML = `
                    <h3>Reaction ID: ${reaction.reactionId}</h3>
                    <p><strong>Reactants:</strong> ${reaction.reactants.join(', ')}</p>
                    <p><strong>Products:</strong> ${reaction.products.map(p => p.chemical).join(', ')}</p>
                    <p><strong>Reaction Type:</strong> ${reaction.reactionType}</p>
                    <p><strong>Balanced Equation:</strong> ${reaction.balancedEquation}</p>
                    <p><strong>Deposition:</strong> ${reaction.deposition.occurs ? 'Yes' : 'No'}</p>
                    <button onclick="deleteReaction(${index})">Delete</button>
                `;

                container.appendChild(card);
            });
        }

        function deleteReaction(index) {
            reactions.splice(index, 1);
            displayReactions();
            saveChanges();
        }

        document.getElementById('addReactionButton').onclick = function() {
            const reactants = Array.from(document.getElementById('reactantSelect').selectedOptions).map(option => option.value);
            const products = Array.from(document.getElementById('productSelect').selectedOptions).map(option => ({
                chemical: option.value,
                state: 'aqueous',
                color: 'colorless' // Set default properties for products
            }));
            const reactionType = document.getElementById('reactionType').value;
            const balancedEquation = document.getElementById('balancedEquation').value;
            const depositionOccurs = document.querySelector('input[name="deposition"]:checked').value === 'true';

            if (reactants.length && products.length && reactionType && balancedEquation) {
                const newReaction = {
                    reactionId: `R00${reactions.length + 1}`,
                    reactants: reactants,
                    products: products,
                    reactionType: reactionType,
                    balancedEquation: balancedEquation,
                    deposition: { occurs: depositionOccurs, details: '' }
                };

                reactions.push(newReaction);
                displayReactions();
                saveChanges();
            } else {
                alert('Please fill in all fields.');
            }
        };

        function saveChanges() {
            fetch('/reactions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ reactions: reactions }),
            })
            .then(response => response.text())
            .then(data => console.log(data))
            .catch(error => console.error('Error saving changes:', error));
        }
    </script>
</body>
</html>
